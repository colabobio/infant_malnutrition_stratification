---
title: "4.1 Feature Selection/Machine Learning"
author: "Justin Guerra"
date: "2023-11-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# libraries needed
library(tidyverse)  # most variable creation here uses tidyverse 
library(tidyselect) # used to select variables in FP_EVENTS.R
library(haven)      # used for Haven labeled DHSvariables
library(labelled)   # used for Haven labeled variable creation
library(expss)    # for creating tables with Haven labeled df
library(readxl)     # for exporting to excel
library(naniar)   # to use replace_with_na function
library(here)       # to get R project path
library(sjlabelled) # to set variables label
library(survey)  # to calculate weighted ratio for GAR
library(Hmisc)
library(tidyr)
library(mltools)
library(Boruta)
```

```{r}
path <- "/Users/justi/OneDrive/Desktop/colabo_data/data/recoded.rda"
#path <- "data/DHS-2019-21/"

load(file = path)
```


```{r}
pattern = "^v[0-9][0-9][0-9]*|^hv[0-9][0-9][0-9]*|^ml[0-9][0-9]*|^h[0-9][0-9]|^s[0-9][0-9][0-9]*|^shb[0-9][0-9][0-9]*|^h[a-z][0-9]*|^b[0-9]*|^sh[0-9]*|^m[0-9]*|^sb[0-9]*|^h[0-9]*|^v3a*|^sv[0-9]*|^je[0-9]*|awfact*|idx*|dptb*|flpv*"

var = stringr::str_detect(string = df %>% colnames(),
                     pattern = pattern)

selected_var = df[!var] %>% colnames()

```
```{r}

var_class = df[!var] %>% sapply(class) %>% unlist() %>% as.data.frame() %>% rownames_to_column(var = "variable_name")

character_variables = var_class %>% dplyr::filter(`.` == "character") %>% dplyr::select(variable_name) %>%
  dplyr::pull()

df[sapply(df, is.character)] <- lapply(df[sapply(df, is.character)], 
       as.factor)

factor_variables = var_class %>% dplyr::filter(`.` == "factor") %>% dplyr::select(variable_name) %>%
  dplyr::pull()

```

```{r}
onehot_encoding = one_hot(as.data.table(df[factor_variables]),
        naCols = TRUE,
        sparsifyNAs =TRUE)
onehot_encoding
```

```{r}
NA_OHE_vars = onehot_encoding %>% colnames() %>% str_subset(pattern = "_NA$")
onehot_encoding_noNAs = onehot_encoding %>% dplyr::select(-c(NA_OHE_vars, "ciaf_0"))
```
```{r}
# #make this example reproducible
# set.seed(1)
# 
# #use 70% of dataset as training set and 30% as test set
# sample <- sample(c(TRUE, FALSE), nrow(onehot_encoding_noNAs), replace=TRUE, prob=c(0.2,0.8))
# train  <- onehot_encoding_noNAs[sample, ]
# test   <- onehot_encoding_noNAs[!sample, ]
```



## Boruta

```{r}
# set.seed(12)
# boruta <- Boruta(ciaf_1~., data =train, doTrace = 2, maxRuns = 12)
```

```{r}
onehot_encoding_noNAs$ci
```



